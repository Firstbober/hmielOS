import"./fs.373cbe91.js";import{l as L,s as h,a as c}from"./std.2cba84a3.js";function C(e){return typeof e=="object"&&e!==null}function B(e){return C(e)&&typeof e.length=="number"}function $(e){return Array.isArray(e)?e:e===void 0?[]:B(e)||e instanceof Set?Array.from(e):[e]}const b="\x1B[",n={};n.style={reset:"\x1B[0m",bold:"\x1B[1m",italic:"\x1B[3m",underline:"\x1B[4m",fontDefault:"\x1B[10m",font2:"\x1B[11m",font3:"\x1B[12m",font4:"\x1B[13m",font5:"\x1B[14m",font6:"\x1B[15m",imageNegative:"\x1B[7m",imagePositive:"\x1B[27m",black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",grey:"\x1B[90m",gray:"\x1B[90m",brightRed:"\x1B[91m",brightGreen:"\x1B[92m",brightYellow:"\x1B[93m",brightBlue:"\x1B[94m",brightMagenta:"\x1B[95m",brightCyan:"\x1B[96m",brightWhite:"\x1B[97m","bg-black":"\x1B[40m","bg-red":"\x1B[41m","bg-green":"\x1B[42m","bg-yellow":"\x1B[43m","bg-blue":"\x1B[44m","bg-magenta":"\x1B[45m","bg-cyan":"\x1B[46m","bg-white":"\x1B[47m","bg-grey":"\x1B[100m","bg-gray":"\x1B[100m","bg-brightRed":"\x1B[101m","bg-brightGreen":"\x1B[102m","bg-brightYellow":"\x1B[103m","bg-brightBlue":"\x1B[104m","bg-brightMagenta":"\x1B[105m","bg-brightCyan":"\x1B[106m","bg-brightWhite":"\x1B[107m"};n.rgb=function(e,i,t){return`\x1B[38;2;${e};${i};${t}m`};n.bgRgb=function(e,i,t){return`\x1B[48;2;${e};${i};${t}m`};n.styles=function(e){return e=$(e),e.map(function(i){const t=i.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/),a=i.match(/bg-rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(a){const[r,s,u,l]=a;return n.bgRgb(s,u,l)}else if(t){const[r,s,u,l]=t;return n.rgb(s,u,l)}else return n.style[i]}).join("")};n.format=function(e,i){const t=/\[([\w\s-\(\),]+)\]{([^]*?)}/;let a;if(e=String(e),!e)return"";for(;a=e.match(t);){const r=a[1].split(/\s+/),s=a[2];e=e.replace(a[0],n.format(s,r))}return i&&i.length?n.styles(i)+e+n.style.reset:e};n.cursor={up:function(e){return b+(e||1)+"A"},down:function(e){return b+(e||1)+"B"},forward:function(e){return b+(e||1)+"C"},back:function(e){return b+(e||1)+"D"},nextLine:function(e){return b+(e||1)+"E"},previousLine:function(e){return b+(e||1)+"F"},horizontalAbsolute:function(e){return b+e+"G"},position:function(e,i){return b+(e||1)+";"+(i||1)+"H"},hide:b+"?25l",show:b+"?25h"};n.erase={display:function(e){return b+(e||0)+"J"},inLine:function(e){return b+(e||0)+"K"}};function D(e){const i=e.split("\u2588");return{domCode:i[0],domKey:i[1],ctrlKey:Boolean(Number(i[2]=="1")),altKey:Boolean(Number(i[3])),shiftKey:Boolean(Number(i[4]))}}async function A(e){}L().then(async()=>{const e=new TextDecoder,i=await h.syscalls.open("/system/config/motd",1,2,0);if(i.ok){const l=await h.syscalls.read(i.value,-1,0);if(!l.ok)await c.print("Couldn't read '/system/config/motd'");else{const m=e.decode(l.value);await c.print(m)}}await c.printraw("[hmielOS]$ ");let t=0,a=[""],r=0,s=0;const u=["Key","Numpad","Digit","Bracket","Semicolon","Backslash","Quote","Minus","Plus","Equal","Backquote","Comma","Period","Slash","Space"];for(;;){const l=await h.syscalls.read(0,-1,0);if(!l.ok)continue;const m=D(e.decode(l.value));switch(m.domCode){case"Enter":await c.printraw(`
\r[hmielOS]$ `),t+=1,await A(a[t]),a[t]="",r=0,s=0;break;case"ArrowUp":case"ArrowDown":const w=m.domCode.endsWith("Up"),y=m.domCode.endsWith("Down"),x=async o=>{let d="";r!=0&&(d+=n.cursor.forward(r),r=0),a[t]!=""&&(d+=n.cursor.back(a[t].length)),d+=n.erase.inLine(),t+=o,d+=a[t],r=0,s=a[t].length,await c.printraw(d)};w&&t>0&&await x(-1),y&&t+1<a.length&&await x(1);break;case"ArrowLeft":case"ArrowRight":const k=m.domCode.endsWith("Left"),p=m.domCode.endsWith("Right");k&&r!=a[t].length&&(await c.printraw(n.cursor.back(1)),r+=1,s-=1),p&&r!=0&&(await c.printraw(n.cursor.forward(1)),r-=1,s+=1);break;case"Backspace":const g=a[t];if(r!=0&&s!=0){let o="";o+=n.cursor.back(1),o+=n.erase.inLine(),o+=g.slice(g.length-r),o+=n.cursor.back(r),a[t]=[g.slice(0,g.length-r-1),g.slice(g.length-r)].join(""),await c.printraw(o),s-=1;break}g.length!=0&&r==0&&s!=0&&(a[t]=g.slice(0,-1),await c.printraw(n.cursor.back(1)+n.erase.inLine()),s-=1);break;default:let f="";for(const o of u)if(m.domCode.startsWith(o)){f=m.domKey;break}if(r!=0){const o=a[t];a[t]=[o.slice(0,o.length-r),f,o.slice(o.length-r)].join(""),await c.printraw(`${n.erase.inLine()}${f}${o.slice(o.length-r)}${n.cursor.back(r)}`)}else a[t]+=f,await c.printraw(f);s+=1;break}}});
